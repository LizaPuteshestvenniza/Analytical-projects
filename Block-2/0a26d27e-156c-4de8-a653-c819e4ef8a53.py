#!/usr/bin/env python
# coding: utf-8

# <div style="border:solid green 2px; padding: 20px">
# <b>–ï–ª–∏–∑–∞–≤–µ—Ç–∞, –ø—Ä–∏–≤–µ—Ç!</b>
# 
# –ú–µ–Ω—è –∑–æ–≤—É—Ç –ï–≤–≥–µ–Ω–∏–π –î–∞—â–µ–Ω–∫–æ, –∏ —è –±—É–¥—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –ü—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—â–∞—Ç—å—Å—è –Ω–∞ ¬´—Ç—ã¬ª üòä –ù–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —É–¥–æ–±–Ω–æ - –¥–∞–π –∑–Ω–∞—Ç—å, –∏ –º—ã –ø–µ—Ä–µ–π–¥–µ–º –Ω–∞ "–≤—ã".¬†
# 
# –ú–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –Ω–µ —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ç–æ–±–æ—é –æ—à–∏–±–∫–∏, –∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º –∏ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å—Ç–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö. –¢—ã —É–∂–µ –ø—Ä–æ–¥–µ–ª–∞–ª –±–æ–ª—å—à—É—é —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º, –Ω–æ –¥–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –µ–≥–æ –µ—â–µ –ª—É—á—à–µ. –ù–∏–∂–µ —Ç—ã –Ω–∞–π–¥–µ—à—å –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–π, –Ω–µ –∏–∑–º–µ–Ω—è–π –∏ –Ω–µ —É–¥–∞–ª—è–π –∏—Ö. –Ø –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é —Ä–∞–∑–º–µ—Ç–∫—É:
# 
# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b> –¢–∞–∫ –≤—ã–¥–µ–ª–µ–Ω—ã —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è. –ë–µ–∑ –∏—Ö –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç. </div>
# 
# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b> –¢–∞–∫ –≤—ã–¥–µ–ª–µ–Ω—ã –Ω–µ–±–æ–ª—å—à–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è. –û–¥–Ω–∞-–¥–≤–∞ —Ç–∞–∫–∏—Ö –∑–∞–º–µ—á–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–ø—É—Å—Ç–∏–º—ã, –Ω–æ –µ—Å–ª–∏ –∏—Ö –±—É–¥–µ—Ç –±–æ–ª—å—à–µ - —Ç–µ–±–µ –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–Ω–µ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –≠—Ç–æ –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∏–µ–º–µ –Ω–∞ —Ä–∞–±–æ—Ç—É: –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –æ—à–∏–±–æ–∫ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å –ø—Ä–∏—á–∏–Ω–æ–π –æ—Ç–∫–∞–∑–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç—É. 
# 
# </div>
# 
# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b> –¢–∞–∫ —è –≤—ã–¥–µ–ª—è—é –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.</div>
# 
# –î–∞–≤–∞–π —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º –≤ –¥–∏–∞–ª–æ–≥–µ: –µ—Å–ª–∏ —Ç—ã —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—à—å –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏–ª–∏ –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –º–æ–∏ –∫–æ–º–º–µ–Ω–∞—Ç—Ä–∏ ‚Äî –ø–∏—à–∏ –æ–± —ç—Ç–æ–º. –ú–Ω–µ –±—É–¥–µ—Ç –ª–µ–≥—á–µ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ —Ç—ã –≤—ã–¥–µ–ª–∏—à—å —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Ç —Ç–∞–∫.</div>
# 
# –í—Å—ë —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–µ–µ. 

# #  –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ –¥–ª—è —Ç–µ–ª–µ–∫–æ–º-–∫–æ–º–ø–∞–Ω–∏–∏

# –ö–ª–∏–µ–Ω—Ç–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –¥–≤–∞ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞: ¬´–°–º–∞—Ä—Ç¬ª –∏ ¬´–£–ª—å—Ç—Ä–∞¬ª. –ß—Ç–æ–±—ã —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã–π –±—é–¥–∂–µ—Ç, –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Ö–æ—á–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π —Ç–∞—Ä–∏—Ñ –ø—Ä–∏–Ω–æ—Å–∏—Ç –±–æ–ª—å—à–µ –¥–µ–Ω–µ–≥.
# 
# –ü—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–∞—Ä–∏—Ñ–æ–≤ –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä–∫–µ –∫–ª–∏–µ–Ω—Ç–æ–≤. –í —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã–µ 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ¬´–ú–µ–≥–∞–ª–∞–π–Ω–∞¬ª: –∫—Ç–æ –æ–Ω–∏, –æ—Ç–∫—É–¥–∞, –∫–∞–∫–∏–º —Ç–∞—Ä–∏—Ñ–æ–º –ø–æ–ª—å–∑—É—é—Ç—Å—è, —Å–∫–æ–ª—å–∫–æ –∑–≤–æ–Ω–∫–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—ã–π –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞ 2018 –≥–æ–¥. –ù—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ ‚Äî –∫–∞–∫–æ–π —Ç–∞—Ä–∏—Ñ –ª—É—á—à–µ. 

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –ó–¥–æ—Ä–æ–≤–æ, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —Å–∞–º –ø—Ä–æ–µ–∫—Ç, –∫–∞–∂–¥—ã–π —Å–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–µ–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ / –¥–µ—Ç–∞–ª—è—Ö —Ä–∞–±–æ—Ç—ã. 
# 
# </div>

# ## –ò–∑—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞

# In[1]:


import pandas as pd 
import matplotlib.pyplot as plt
from IPython.display import display
import numpy as np
import warnings 
from scipy import stats as st
warnings.filterwarnings('ignore')

def read(data):  #<—Ñ—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ —Ç–∞–±–ª–∏—Ü>
    display(data.head(10))
    print('–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤:')
    print(data.isnull().sum())
    print('')
    print('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: ', data.duplicated().sum())
    print('')
    print(data.info())
    
df_calls = pd.read_csv('/datasets/calls.csv')
df_internet = pd.read_csv('/datasets/internet.csv')
df_messages = pd.read_csv('/datasets/messages.csv')
df_tariffs = pd.read_csv('/datasets/tariffs.csv')
df_users = pd.read_csv('/datasets/users.csv')

datas = [df_calls, 
         df_internet, 
         df_messages, 
         df_tariffs, 
         df_users]

datas_name = ['–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–≤–æ–Ω–∫–∞—Ö', 
              '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–µ—Å—Å–∏—è—Ö',
              '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö',
              '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–∞—Ö',
              '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö']

for i,j in zip(datas, datas_name) : 
    print(j)
    read(i)
    print('')


# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –û—Ç–ª–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö üëç
# </div>

# –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–ª—É—á–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ:
# 
# –£ –Ω–∞—Å 5 —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∞ –∏–º–µ–Ω–Ω–æ:
# * users
# * calls
# * messages
# * internet
# * tariffs
# 
# –û–±—Ä–∞—Ç–∏–º –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É –æ—Ç–¥–µ–ª—å–Ω–æ, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –æ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è: 
# - –¢–∞–±–ª–∏—Ü–∞ users (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö):
#  * user_id ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
#  * first_name ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
#  * last_name ‚Äî —Ñ–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
#  * age ‚Äî –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≥–æ–¥—ã)
#  * reg_date ‚Äî –¥–∞—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞ (–¥–µ–Ω—å, –º–µ—Å—è—Ü, –≥–æ–¥)
#  * churn_date ‚Äî –¥–∞—Ç–∞ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–º (–µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ, —Ç–æ —Ç–∞—Ä–∏—Ñ –µ—â—ë –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö)
#  * city ‚Äî –≥–æ—Ä–æ–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
#  * tarif ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
# 8 —Å—Ç–æ–ª–±—Ü–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ int64(2), object(6)
# 
# 
# - –¢–∞–±–ª–∏—Ü–∞ calls (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–≤–æ–Ω–∫–∞—Ö):
#  * id ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∑–≤–æ–Ω–∫–∞
#  * call_date ‚Äî –¥–∞—Ç–∞ –∑–≤–æ–Ω–∫–∞
#  * duration ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤–æ–Ω–∫–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö
#  * user_id ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–¥–µ–ª–∞–≤—à–µ–≥–æ –∑–≤–æ–Ω–æ–∫
# 4 —Å—Ç–æ–ª–±—Ü–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ float64(1), int64(1), object(2)
# 
# 
# - –¢–∞–±–ª–∏—Ü–∞ messages (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö):
#  * id ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
#  * message_date ‚Äî –¥–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
#  * user_id ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç–ø—Ä–∞–≤–∏–≤—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
# 3 —Å—Ç–æ–ª–±—Ü–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ int64(1), object(2)
# 
# 
# - –¢–∞–±–ª–∏—Ü–∞ internet (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–µ—Å—Å–∏—è—Ö):
#  * Unnamed: 0 - ?
#  * id ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å–µ—Å—Å–∏–∏
#  * mb_used ‚Äî –æ–±—ä—ë–º –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–≥–æ –∑–∞ —Å–µ—Å—Å–∏—é –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞ (–≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö)
#  * session_date ‚Äî –¥–∞—Ç–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–µ—Å—Å–∏–∏
#  * user_id ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# 5 —Å—Ç–æ–ª–±—Ü–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ float64(1), int64(2), object(2); –û–¥–Ω–∞–∫–æ –≤ –∑–∞–¥–∞–Ω–∏–∏ –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–æ 4 —Å—Ç–æ–ª–±—Ü–∞, –≤—ã—è–≤–ª–µ–Ω —Å—Ç–æ–ª–±–µ—Ü *Unnamed: 0* –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –µ–≥–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ. 
# 
# 
# - –¢–∞–±–ª–∏—Ü–∞ tariffs (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–∞—Ö):
#  * tariff_name ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
#  * rub_monthly_fee ‚Äî –µ–∂–µ–º–µ—Å—è—á–Ω–∞—è –∞–±–æ–Ω–µ–Ω—Ç—Å–∫–∞—è –ø–ª–∞—Ç–∞ –≤ —Ä—É–±–ª—è—Ö
#  * minutes_included ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω—É—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ –º–µ—Å—è—Ü, –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö –≤ –∞–±–æ–Ω–µ–Ω—Ç—Å–∫—É—é –ø–ª–∞—Ç—É
#  * messages_included ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–µ—Å—è—Ü, –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö –≤ –∞–±–æ–Ω–µ–Ω—Ç—Å–∫—É—é –ø–ª–∞—Ç—É
#  * mb_per_month_included ‚Äî –æ–±—ä—ë–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞, –≤–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –≤ –∞–±–æ–Ω–µ–Ω—Ç—Å–∫—É—é –ø–ª–∞—Ç—É (–≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö)
#  * rub_per_minute ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∏–Ω—É—Ç—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å–≤–µ—Ä—Ö —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤ —Ç–∞—Ä–∏—Ñ–µ 100 –º–∏–Ω—É—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ –º–µ—Å—è—Ü, —Ç–æ —Å–æ 101 –º–∏–Ω—É—Ç—ã –±—É–¥–µ—Ç –≤–∑–∏–º–∞—Ç—å—Å—è –ø–ª–∞—Ç–∞)
#  * rub_per_message ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–≤–µ—Ä—Ö —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞
#  * rub_per_gb ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥–∏–≥–∞–±–∞–π—Ç–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞ —Å–≤–µ—Ä—Ö —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (1 –≥–∏–≥–∞–±–∞–π—Ç = 1024 –º–µ–≥–∞–±–∞–π—Ç–∞)
# 8 —Å—Ç–æ–ª–±—Ü–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ int64(7), object(1)
# 
# 
# **–í—ã–≤–æ–¥:**
# 
# –í –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–¥–µ–∂–∏—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤, –∫—Ä–æ–º–µ —Å—Ç–æ–ª–±—Ü–∞ *churn_date*, –Ω–æ —ç—Ç–∏ –ø—Ä–æ–ø—É—Å–∫–∏ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω—ã —Ç–µ–º, —á—Ç–æ —Ç–∞—Ä–∏—Ñ –µ—â—ë –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü. –û–¥–Ω–∞–∫–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ. –ë–æ–ª–µ–µ —Ç–æ–≥–æ –Ω–∞–¥–æ –±—É–¥–µ—Ç —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫. 

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ –∏–∑—É—á–∏–ª–∏ –Ω–∞—à–∏ –ø–µ—Ä–≤–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–∞–≤–∞–π —Ç–µ–ø–µ—Ä—å –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∞–µ–º. 
#     
# 
#     
# </div>

# ## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
# 
# ### –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞

# –¢–∞–∫ –∫–∞–∫ —Ç–∞–±–ª–∏—Ü –¥–æ–≤–æ–ª—å–Ω–æ –º–Ω–æ–≥–æ –±—É–¥–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ. 
# 
# –ù–∞—á–Ω–µ–º —Å —Ç–∞–±–ª–∏—Ü—ã *users*: –≤ –¥–≤—É—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö *churn_date* –∏ *reg_date* –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã 

# In[2]:


columns_users_time = ['churn_date', 'reg_date']

for i in columns_users_time:
    df_users[i] = pd.to_datetime(df_users[i], format='%Y-%m-%d')


# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫: –≤—ã–≤–µ–¥–µ–º –º–µ—Ç–æ–¥–æ–º *unique()* —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–æ–ª–±—Ü–æ–≤ *age*, *city* –∏ *tariff*

# In[3]:


columns_users_check = ['age', 'city', 'tariff']

for i in columns_users_check:
    print(df_users[i].unique())
    print('******************')


# –û—à–∏–±–æ–∫ –≤ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è.
# 
# –ü–µ—Ä–µ–π–¥–µ–º –∫ —Ç–∞–±–ª–∏—Ü–µ *calls*: —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –∑–≤–æ–Ω–∫–∏, —Å–∫–æ–ª—å–∫–æ –±—ã —Å–µ–∫—É–Ω–¥ –æ–Ω–∏ –Ω–µ –¥–ª–∏–ª–∏—Å—å, –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É, –ø—Ä–æ–≤–µ–¥–µ–º —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é –∏ –∑–∞–º–µ–Ω–∏–º —Ç–∏–ø –Ω–∞ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π. –ê —Ç–∞–∫ –∂–µ –ø–µ—Ä–µ–≤–µ–¥–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ *call_date*

# In[4]:


df_calls['duration'] = np.ceil(df_calls['duration'])
df_calls['duration'] = df_calls['duration'].astype('int')

df_calls['call_date'] = pd.to_datetime(df_calls['call_date'], format='%Y-%m-%d')


# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –•–æ—Ä–æ—à–æ, —á—Ç–æ —É—á–∏—Ç—ã–≤–∞–µ–º —É—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Å–≤—è–∑–∏ –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–µ—Ç–æ–¥ `np.ceil`
#     
#     
# </div>

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# <s>–û–¥–Ω–∞–∫–æ –º–µ—Ç–æ–¥ `np.ceil` –ª—É—á—à–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫–æ –≤—Å–µ–º—É —Å—Ç–æ–ª–±—Ü—É —Ü–µ–ª–∏–∫–æ–º, —Ç–∞–∫ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ.  
#     
# `np.ceil(df['column'])`
#     
# </div>

# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫: –ø–æ—Å–º–æ—Ç—Ä–∏–º –º–µ—Ç–æ–¥–∞–º–∏ *min()* –∏ *max()* –ø—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–æ–ª–±—Ü–∞ *duration* –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤:

# In[5]:


print(df_calls['duration'].min())
print(df_calls['duration'].max())


# –ó–∞–º–µ—Ç–Ω—ã—Ö –≤—ã–±—Ä–æ—Å–æ–≤ –Ω–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è.  
# 
# –ü–µ—Ä–µ–π–¥–µ–º –∫ —Ç–∞–±–ª–∏—Ü–µ *messages*: –ø—Ä–∏–≤–µ–¥–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–æ–ª–±–µ—Ü *message_date* –≤ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:

# In[6]:


df_messages['message_date'] = pd.to_datetime(df_messages['message_date'], format='%Y-%m-%d')


# –í —Ç–∞–±–ª–∏—Ü–µ *internet* —Å—Ç–æ–ª–±–µ—Ü *mb_used* –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö, —Ç–∞–∫ –∫–∞–∫ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–Ω–∏–º–∞–µ—Ç—Å—è –∑–∞ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –≥–∏–≥–∞–±–∞–π—Ç, –ø–µ—Ä–µ–≤–µ–¥–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –≥–∏–≥–∞–±–∞–π—Ç—ã, –Ω–æ –ø–æ–∫–∞ –æ–∫—Ä—É–≥–ª—è—Ç—å –Ω–µ –±—É–¥–µ–º, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –æ —Å—É–º–º–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∏–≥–∞–±–∞–π—Ç, –∞ –æ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ, —Ç–∞–∫ –∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ–º —Å—Ç–æ–ª–±–µ—Ü *session_date* –≤ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã.

# In[7]:


df_internet['mb_used'] = df_internet['mb_used'] / 1000

df_internet['session_date'] = pd.to_datetime(df_internet['session_date'], format='%Y-%m-%d')


# –û–¥–Ω–∞–∫–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å—Ç–æ–ª–±–µ—Ü, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∏ —É –Ω–µ–≥–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ. –û–ø—Ä–µ–¥–µ–ª–∏–º –µ–≥–æ –º–µ—Ç–æ–¥–æ–º *columns()* –∏ –ø—Ä–æ–≤–µ—Ä–∏–º –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–µ—Ç–æ–¥–æ–º *unique()*:

# In[8]:


print(df_internet.columns)
print(df_internet['Unnamed: 0'].unique())


# –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–æ–ª–±–µ—Ü –¥—É–±–ª–∏—Ä—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã, —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç—Å–æ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –Ω–µ–≥–æ. 

# In[9]:


df_internet.drop('Unnamed: 0', axis=1, inplace=True)


# –ü–µ—Ä–µ–π–¥–µ–º –∫ —Ç–∞–±–ª–∏—Ü–µ *tariffs*: –≤ –Ω–µ–π —É–∫–∞–∑–∞–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ *mb_per_month_included*, –≤–µ–¥—å —É —Ç–∞—Ä–∏—Ñ–∞ ¬´–°–º–∞—Ä—Ç¬ª –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–æ–≤–Ω–æ 15 –ì–±, –∞ —É ¬´–£–ª—å—Ç—Ä–∞¬ª - 30 –ì–±, –∏—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ. 

# In[10]:


df_tariffs['mb_per_month_included'][0] = 15000
df_tariffs['mb_per_month_included'][1] = 30000


# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

# In[11]:


for i,j in zip(datas, datas_name) : 
    print(j)
    print(i.info())
    print('')


# **–í—ã–≤–æ–¥**:
# 
# –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞, –∫–∞–∫–∏–µ —Ç–æ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ–ª–∏ –æ—à–∏–±–∫–∏: –Ω–µ–≤–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ª–∏—à–Ω–∏–µ —Å—Ç–æ–ª–±—Ü—ã, –æ–¥–Ω–∞–∫–æ –ø–æ –∏—Ç–æ–≥—É –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –∫ –∞–Ω–∞–ª–∏–∑—É. 

# ### –†–∞—Å—á–µ—Ç—ã –∑–∞—Ç—Ä–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# #### –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤, —Å–º—Å –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–µ—Å—Å–∏–π
# 
# –ü–æ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ –∏ –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–Ω—ã—Ö –º–∏–Ω—É—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

# In[12]:


month =[]
for i in range(1,13):
    month.append(i)

df_month_calls_num = pd.DataFrame(index=df_users['user_id'].unique(), columns = month)
df_month_minutes_num = pd.DataFrame(index=df_users['user_id'].unique(), columns = month)

for i in df_users['user_id'].unique() :
    df_tmp = df_calls[df_calls['user_id'] == i]
    for j in month:
        df_tmp2 = df_tmp[df_tmp['call_date'].dt.month == j]
        df_month_calls_num[j][i] = df_tmp2.shape[0]
        df_month_minutes_num[j][i] = df_tmp2['duration'].sum()
        df_tmp2 = 0
    df_tmp = 0

display(df_month_calls_num.head(10)) 
display(df_month_minutes_num.head(10))


# –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–± —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ–π, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 2 —Ü–∏–∫–ª–∞, –≥–¥–µ –ø–µ—Ä–≤—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∞ –≤—Ç–æ—Ä–æ–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–æ –µ–∂–µ–º–µ—Å—è—á–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–æ—Ç–æ–≤–æ–π —Å–≤–≤—è–∑–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –±—É–¥–µ–º –ø–æ–ª—É—á–∞—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, —Å–æ—Å—Ç–æ—è—é—â–∏–µ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —á–∏—Å–ª–æ –≤—ã–∑–æ–≤–æ–≤, –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã—Ö –º–∏–Ω—É—Ç –Ω–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã - —Å—É–º–º–∞ —Å—Ç–æ–ª–±—Ü–∞ *duration*.
# 
# –ü–æ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–±—ä–µ–º –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º –ø–æ —Ç–æ–º—É –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—É, —á—Ç–æ –∏ —Å—á–∏—Ç–∞–ª–∏ —Ä–∞–Ω–µ–µ:

# In[13]:


df_month_messages_num = pd.DataFrame(index=df_users['user_id'].unique(), columns = month)
df_month_internet_num = pd.DataFrame(index=df_users['user_id'].unique(), columns = month)

for i in df_users['user_id'].unique() :
    df_tmp = df_messages[df_messages['user_id'] == i]
    for j in month:
        df_tmp2 = df_tmp[df_tmp['message_date'].dt.month == j]
        df_month_messages_num[j][i] = df_tmp2.shape[0]
        df_tmp2 = 0
    df_tmp = 0
    
for i in df_users['user_id'].unique() :
    df_tmp = df_internet[df_internet['user_id'] == i]
    for j in month:
        df_tmp2 = df_tmp[df_tmp['session_date'].dt.month == j]
        df_month_internet_num[j][i] = df_tmp2['mb_used'].sum()
        df_tmp2 = 0
    df_tmp = 0

display(df_month_messages_num.head(10)) 
display(df_month_internet_num.head(10)) 


# –ü—Ä–µ–∂–¥–µ —á–µ–º –≤—ã—á–∏—Å–ª—è—Ç—å –ø–æ–º–µ—Å—è—á–Ω—É—é –ø—Ä–∏–±—ã–ª—å –ø—Ä–∏–≤–µ–¥–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –ø–æ–¥–æ–±–∞—é—â–∏–π –≤–∏–¥:

# In[14]:


options = [df_month_calls_num, 
           df_month_minutes_num, 
           df_month_messages_num,
           df_month_internet_num]

col = ['—è–Ω–≤–∞—Ä—å', '—Ñ–µ–≤—Ä–∞–ª—å', '–º–∞—Ä—Ç', 
       '–∞–ø—Ä–µ–ª—å', '–º–∞–π', '–∏—é–Ω—å', 
       '–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å', 
       '–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å', '–¥–µ–∫–∞–±—Ä—å']

for i,j in zip(options, col):
    i.rename(columns={1: '—è–Ω–≤–∞—Ä—å', 
                      2: '—Ñ–µ–≤—Ä–∞–ª—å', 
                      3: '–º–∞—Ä—Ç', 
                      4: '–∞–ø—Ä–µ–ª—å', 
                      5: '–º–∞–π', 
                      6: '–∏—é–Ω—å', 
                      7: '–∏—é–ª—å', 
                      8: '–∞–≤–≥—É—Å—Ç', 
                      9: '—Å–µ–Ω—Ç—è–±—Ä—å', 
                      10: '–æ–∫—Ç—è–±—Ä—å', 
                      11: '–Ω–æ—è–±—Ä—å', 
                      12: '–¥–µ–∫–∞–±—Ä—å'}, inplace=True)
    
    i[j] = i[j].astype('int')


# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –Ø –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç `inplace`, —Ç–∞–∫ –∫–∞–∫ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –±–∏–±–ª–æ—Ç–µ–∫–∏ `pandas` –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.
#     
# –õ—É—á—à–µ –≤—Å–µ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. 
#     
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –ü–æ–º–æ–≥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ, –µ—Å–ª—è —è –ø–∏—à—É i = i.rename...., —Ç–æ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É</div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ (2):</b>
# 
# –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ä–µ—à–µ–Ω–∏–µ —Ç–∞–∫–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –¥–ª—è –Ω–∞—Å –ø–æ–¥—Ö–æ–¥–∏—Ç, –Ω–æ –ª—É—á—à–µ –∏–º–µ—Ç—å –≤ –≤–∏–¥—É –Ω–∞ –±—É–¥—É—â–µ–µ –ø–æ –ø–æ–≤–æ–¥—É `inplace`
#     
#     
# </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –ö—Å—Ç–∞—Ç–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–Ω–µ–π–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, —ç—Ç–æ –∫–æ–≥–¥–∞ –≤ —Å—Ç—Ä–æ–∫–∞—Ö —É –Ω–∞—Å —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ: 
# 
# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –º–µ—Å—è—Ü - –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
#     
# –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã —Å–º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –Ω–∞—à —Ä–∞—Å—á–µ—Ç –ø—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ.
#     
#     
# </div>

# –û—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–µ–º –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –∏ –≤–≤–µ–¥–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ *user_id*:

# In[15]:


df_month_calls_num = df_month_calls_num.reset_index()
df_month_minutes_num = df_month_minutes_num.reset_index()
df_month_messages_num = df_month_messages_num.reset_index()
df_month_internet_num = df_month_internet_num.reset_index()

df_month_calls_num.rename(columns={'index': 'user_id'}, inplace=True)
df_month_minutes_num.rename(columns={'index': 'user_id'}, inplace=True)
df_month_messages_num.rename(columns={'index': 'user_id'}, inplace=True)
df_month_internet_num.rename(columns={'index': 'user_id'}, inplace=True)


# –°–æ–µ–¥–∏–Ω–∏–º —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, —á—Ç–æ–± –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞—Ä–∏—Ñ–∞–º, –∏ —É–¥–∞–ª–∏–º –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –Ω–µ–Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã. 

# In[16]:


df_calls_new = df_users.merge(df_month_minutes_num, on='user_id')
df_messages_new = df_users.merge(df_month_messages_num, on='user_id')
df_internet_new = df_users.merge(df_month_internet_num, on='user_id')

drop_columns = ['age', 'churn_date',
                'first_name', 
                'last_name', 'reg_date']

for i in drop_columns:
    df_calls_new = df_calls_new.drop(i, 1)
    df_messages_new = df_messages_new.drop(i, 1)
    df_internet_new = df_internet_new.drop(i, 1)


# –í –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –Ω–∞–π–¥–µ–º –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –≥–¥–µ 1 - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ *smart* –Ω–µ –±—ã–ª –ø—Ä–∏–≤—ã—à–µ–Ω, 2 - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ *ultra* –Ω–µ –±—ã–ª –ø—Ä–∏–≤—ã—à–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–ª–∞—Ç–∏–ª –ø—Ä–æ—Å—Ç–æ –∞–±–æ–Ω–µ–Ω—Ç—Å–∫—É—é –ø–ª–∞—Ç—É, 0 - –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–∞—Ä–∏—Ñ, –±–æ–ª—å—à–µ 3 - —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Ç—Ä–∞—á–µ–Ω–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–≤–µ—Ä—Ö —Ç–∞—Ä–∏—Ñ–∞.

# In[17]:


def tariff_price(df, colum, smart_lim, ultra_lim, smart_price, ultra_price):
    for i in colum:
        for j in range(0, 500):
            if df['tariff'][j] == 'smart':
                if df[i][j] > smart_lim:
                    df[i][j] = (df[i][j] - smart_lim) * smart_price
                else: 
                    if (df[i][j] <= smart_lim and df[i][j] != 0):
                        df[i][j] = 1
                    if  df[i][j] == 0 :
                        df[i][j] = 0
            if df['tariff'][j] == 'ultra':
                if df[i][j] > ultra_lim:
                    df[i][j] = (df[i][j] - ultra_lim) * ultra_price
                else: 
                    if (df[i][j] <= ultra_lim and df[i][j] != 0):
                        df[i][j] = 2
                    if  df[i][j] == 0 :
                        df[i][j] = 0
    return df

df_calls_new = tariff_price(df_calls_new, 
                            col, 
                            df_tariffs['minutes_included'][0], 
                            df_tariffs['minutes_included'][1], 
                            df_tariffs['rub_per_minute'][0], 
                            df_tariffs['rub_per_minute'][1])

df_messages_new = tariff_price(df_messages_new, 
                               col, 
                               df_tariffs['messages_included'][0], 
                               df_tariffs['messages_included'][1], 
                               df_tariffs['rub_per_message'][0], 
                               df_tariffs['rub_per_message'][1])

df_internet_new = tariff_price(df_internet_new, 
                               col, 
                               df_tariffs['mb_per_month_included'][0], 
                               df_tariffs['mb_per_month_included'][1], 
                               df_tariffs['rub_per_gb'][0], 
                               df_tariffs['rub_per_gb'][1])

display(df_calls_new.head(10))
display(df_messages_new.head(10))
display(df_internet_new.head(10))


# #### –°–æ–¥–∞–Ω–∏–µ –æ–±—â–µ–π —Ç–∞–±–ª–∏—Ü—ã —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
# 
# –°–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—Å–µ —Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –≥–æ–¥–∞:

# In[18]:


all_costs = pd.DataFrame(columns = col)
all_costs = df_users.join(all_costs)

drop_columns = ['age', 'churn_date', 
                'first_name', 
                'last_name', 'reg_date']

for i in drop_columns:
    all_costs = all_costs.drop(i, 1)
    
ultra_cost = df_tariffs['rub_monthly_fee'][1]
smart_cost = df_tariffs['rub_monthly_fee'][0]

for i in col:
    for j in range(0,500) :
        if (df_calls_new[i][j] == 0 and df_messages_new[i][j] == 0 and df_internet_new[i][j] ==0):
            all_costs[i][j] = 0
        else:        
            penalty = 0
            if (df_calls_new[i][j] > 2) :
                penalty += df_calls_new[i][j]
            if (df_messages_new[i][j] > 2) :
                penalty += df_messages_new[i][j]
            if (df_internet_new[i][j] > 2) :
                penalty += df_internet_new[i][j]
            if (all_costs['tariff'][j] ==  'smart') :
                all_costs[i][j] = 550 + penalty
            else :
                all_costs[i][j] = 1950 + penalty
display(all_costs.head(10))         
            


# **–í—ã–≤–æ–¥:**
# 
# –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –ø–æ–ª—É—á–∏–ª–∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É *all_costs*, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—É–º–∞—Ä–Ω–æ –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º. –¢–µ–ø–µ—Ä—å –µ–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö.   

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –í—ã—Ä—É—á–∫–∞ –ø–æ—Å—á–∏—Ç–∞–Ω–∞ –≤–µ—Ä–Ω–æ, —Ç–µ–ø–µ—Ä—å –ª—é–±–∞—è —Ñ–∏–Ω.–æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –Ω–∞–º –Ω–µ –ø–æ–º–µ—Ö–∞ üòä
#     
# 
#     
# </div>

# ## –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

# –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∫–∞–∂–¥–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞. –°–æ–∑–¥–∞–¥–∏–º –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∂–¥–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É —Ç–∞–±–ª–∏—Ü—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º –∏ –Ω–∞–π–¥–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞:   

# In[19]:


df_calls_new2 = df_users.merge(df_month_minutes_num, on='user_id')
df_messages_new2 = df_users.merge(df_month_messages_num, on='user_id')
df_internet_new2 = df_users.merge(df_month_internet_num, on='user_id')

for i in drop_columns:
    df_calls_new2 = df_calls_new2.drop(i, 1)
    df_messages_new2 = df_messages_new2.drop(i, 1)
    df_internet_new2 = df_internet_new2.drop(i, 1)

def mean_value(df, columns):
    df_tariffs_parametrs = pd.DataFrame(columns=['smart', 'ultra'], index = col)
    df_smart_parametr = df.query('tariff == "smart"')
    df_ultra_parametr = df.query('tariff == "ultra"')
    df_smart_parametr = df_smart_parametr.reset_index(drop=True)
    df_ultra_parametr = df_ultra_parametr.reset_index(drop=True)
    
    tmp = 0
    array_tmp = []
    for i in columns:
        for j in range(0, df_smart_parametr.shape[0]):
            if df_smart_parametr[i][j] != 0:
                tmp += df_smart_parametr[i][j]
                array_tmp.append(df_smart_parametr[i][j])
        df_tariffs_parametrs['smart'][i] = tmp / len(array_tmp)
        tmp = 0
        array_tmp = []
    for i in columns:
        for j in range(0, df_ultra_parametr.shape[0]):
            if df_ultra_parametr[i][j] != 0:
                tmp += df_ultra_parametr[i][j]
                array_tmp.append(df_ultra_parametr[i][j])
        df_tariffs_parametrs['ultra'][i] = tmp / len(array_tmp)
        tmp = 0
        array_tmp = []
        
    df_tariffs_parametrs.plot(y='smart', 
                         style='-', 
                         grid=True) 
    plt.title('–ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ç–∞—Ä–∏—Ñ–µ smart:')
    plt.show()
    df_tariffs_parametrs.plot(y='ultra', 
                         style='-', 
                         grid=True) 
    plt.title('–ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ç–∞—Ä–∏—Ñ–µ ultra:')
    plt.show()
    display(df_tariffs_parametrs)
    
dfs = [df_calls_new2,
       df_messages_new2,
       df_internet_new2]

names = ['–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∏–Ω—É—Ç–∞—Ö', 
         '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö', 
         '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–µ—Å—Å–∏—è—Ö']

for i, j in zip(dfs, names):
    print(j)
    mean_value(i, col)


# –ü–ª—É—á–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É—é—Ç –æ —Å–∏–ª—å–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏ –∫ –∫–æ–Ω—Ü—É –≥–æ–¥–∞, —ç—Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Å–≤—è–∑–∞–Ω–Ω–æ —Å —Ä–æ—Å—Ç–æ–º —á–∏—Å–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—è—Ü–µ. –ß—Ç–æ–± —É–¥–æ—Å—Ç–æ–≤–µ—Ä–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–æ—Ç–µ —Å—É–∂–¥–µ–Ω–∏–π, –ø—Ä–æ–≤–µ—Ä–∏–º —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–æ—Å—å –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—è—Ü–µ. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ—Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–µ —Ä–∞–≤–Ω—ã—Ö 0 –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–∞–∫–æ–≥–æ –Ω–∏–±—É–¥—å –∏–∑ —Ç–∞—Ä–∏—Ñ–æ–≤:

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –û—Ç–ª–∏—á–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã üëç
#     
#     
# </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –ó–¥–æ—Ä–æ–≤–æ, –∫–æ–≥–¥–∞ –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∏—Ö –æ—Å–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã üòäüëç
#     
# –¢–∞–∫ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–Ω—è—Ç—å –æ —á–µ–º –∏–¥—ë—Ç —Ä–µ—á—å –Ω–∞ —Å–∞–º–æ–º –≥—Ä–∞—Ñ–∏–∫–µ.
#     
# </div>

# In[20]:


cnt = 0
for i in col:
    for j in range(0, 500) :
        if df_month_calls_num[i][j] != 0:
            cnt += 1
    print('–í –º–µ—Å—è—Ü–µ "', i, '" –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç:', cnt)
    cnt = 0


# –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –≤ —Å—Ä–µ–¥–Ω–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—è—Ü–µ —Ä–∞—Å—Ç–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 1,5-2 —Ä–∞–∑–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–º.
# 
# –ù–∞–π–¥–µ–º –µ–∂–µ–º–µ—Å—è—á–Ω—É—é –¥–∏—Å–ø–µ—Ä—Å–∏—é –∏ —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:

# In[21]:


def var_value(df, columns):
    df_tariffs_parametrs = pd.DataFrame(columns=['smart', 'ultra'], index = col)
    df_smart_parametr = df.query('tariff == "smart"')
    df_ultra_parametr = df.query('tariff == "ultra"')
    df_smart_parametr = df_smart_parametr.reset_index(drop=True)
    df_ultra_parametr = df_ultra_parametr.reset_index(drop=True)
    
    array_tmp = []
    for i in columns:
        for j in range(0, df_smart_parametr.shape[0]):
            if df_smart_parametr[i][j] != 0:
                array_tmp.append(df_smart_parametr[i][j])
        df_tariffs_parametrs['smart'][i] = np.var(array_tmp, ddof=0)
        array_tmp = []
    for i in columns:
        for j in range(0, df_ultra_parametr.shape[0]):
            if df_ultra_parametr[i][j] != 0:
                array_tmp.append(df_ultra_parametr[i][j])
        df_tariffs_parametrs['ultra'][i] = np.var(array_tmp, ddof=0)
        array_tmp = []

    print('–î–∏—Å–ø–µ—Ä—Å–∏—è')
    display(df_tariffs_parametrs)
    for i in ['smart', 'ultra']:
        for j in col :
            df_tariffs_parametrs[i][j] = np.sqrt(df_tariffs_parametrs[i][j])
    print('–°—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ')
    display(df_tariffs_parametrs)
    df_tariffs_parametrs.plot(y='smart', 
                         style='-', 
                         grid=True) 
    plt.title('–ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤ —Ç–∞—Ä–∏—Ñ–µ smart:')
    plt.show()
    df_tariffs_parametrs.plot(y='ultra', 
                         style='-', 
                         grid=True) 
    plt.title('–ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤ —Ç–∞—Ä–∏—Ñ–µ ultra:')
    plt.show()

for i, j in zip(dfs, names):
    print(j)
    print('')
    var_value(i, col)


# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –ö—Å—Ç–∞—Ç–∏ –∏–º–µ—è –ª–∏–Ω–µ–π–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –º—ã –º–æ–≥–ª–∏ –±—ã –≤–µ—Å—å —ç—Ç–æ—Ç —Ä–∞—Å—á–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–π —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.
#     
# –ì–¥–µ –≤ –∞—Ç—Ä–∏–±—É—Ç–µ `aggfunc` –º—ã —É–∫–∞–∑–∞–ª–∏ –±—ã –Ω—É–∂–Ω—ã–µ –Ω–∞–º –º–µ—Ç—Ä–∏–∫–∏ ‚Äì `aggfunc = [np.var, np.std,]` –∏ —Ç.–¥.
#     
# </div>

# **–í—ã–≤–æ–¥**
# 
# –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∏–º–µ—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö, –∞ –∏–º–µ–Ω–Ω–æ: –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ —É–∑–Ω–∞—Ç—å –≤ –∫–∞–∫–æ–º –¥–∏–∞–ø–æ–∑–æ–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è 95% –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —Å—Ä–µ–¥–Ω–∏–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞, –∏ –∫–∞–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—è—Ü–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–ø—Ä–æ—Å –∏ –≤—ã—Ä—É—á–∫—É. 

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –û—á–µ–Ω—å –¥–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ –Ω–∞—à –∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—ã–≤–æ–¥—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª–æ–≥–∏—á–Ω—ã –∏ –¥–∞–∂–µ –ø—Ä–∏–¥—Ä–∞—Ç—å—Å—è –Ω–µ –∫ —á–µ–º—É üòäüëç
#     
# –ü—Ä–µ–¥–ª–∞–≥–∞—é –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞—à–∏—Ö –≥–∏–ø–æ—Ç–µ–∑.
#     
# </div>

# ## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑
# 
# ### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π –≤—ã—Ä—É—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–∑–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤

# –ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –°—Ç—ä—é–¥–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≥–∏–ø–æ—Ç–µ–∑. 
# 
# –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ–º –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É: —Å—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ —Å —Ç–∞—Ä–∏—Ñ–∞ ultra —Ä–∞–≤–Ω–∞ —Å—Ä–µ–¥–Ω–µ–π –≤—ã—Ä—É—á–∫–µ —Ç–∞—Ä–∏—Ñ–∞ smart;
# –¢–æ–≥–¥–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ –±—É–¥–µ—Ç –≥–ª–∞—Å–∏—Ç—å: –≤—ã—Ä—É—á–∫–∏ —Å –æ–±–æ–∏—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è. 
# 
# –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –≥–∏–ø–æ—Ç–µ–∑–æ–π –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É *all_costs*, –ø–æ–ª—É—á–µ–Ω–Ω—É—é –≤ 3 –ø—É–Ω–∫—Ç–µ, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–±–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–±—ã–ª–∏ —Å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–æ–∏—Ö —Ç–∞—Ä–∏—Ñ–æ–≤. 

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –ì–∏–ø–æ—Ç–µ–∑—ã —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã –≤–µ—Ä–Ω–æ.
#     
#     
# **Best practies:**
#     
# –ü–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –≤—ã–±–æ—Ä–æ–∫, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç `equal_val` –≤ –¢‚Äì—Ç–µ—Å—Ç–µ.
#     
# –í —Ç–æ–º —á–∏—Å–ª–µ —Å—Ç–æ–∏—Ç –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–∏, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ª–∏ —É –Ω–∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–ª–∏ –Ω–µ—Ç.
#     
# –¢–∞–∫ –º—ã –ø–æ–∫–∞–∂–µ–º –ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.
#     
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –ù–µ –ø–æ–¥—Å–∫–∞–∂–µ—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç?</div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ (2):</b>
# 
# –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª, —Ç–æ –≤ —ç—Ç–æ–º –Ω–∞–º –ø–æ–º–æ–≥—É—Ç `xlim` / `ylim` –∏ –ø–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π.
#     
# https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xlim.html
# 
#     
# https://stackoverflow.com/questions/3100985/plot-with-custom-text-for-x-axis-points
#     
#     
# </div>

# In[22]:


smart_query = all_costs.query('tariff == "smart"')
ultra_query = all_costs.query('tariff == "ultra"')

def tariff_m(tariff_query):
    tariff_query = tariff_query.reset_index(drop=True)
    tariff_mean = []
    for i in col:
        for j in range(0, tariff_query.shape[0]):
            if tariff_query[i][j] != 0:
                tariff_mean.append(tariff_query[i][j])
    return tariff_mean

smart_mean = tariff_m(smart_query)
ultra_mean = tariff_m(ultra_query)

smart_var = np.var(smart_mean)
ultra_var = np.var(ultra_mean)

if (smart_var == ultra_var) :
    print('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å equal_val = True')
else:
    print('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å equal_val = False')


# In[23]:


results = st.ttest_ind(smart_mean, ultra_mean, equal_var = False)
print('p-–∑–Ω–∞—á–µ–Ω–∏–µ: ', results.pvalue)


# P-–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, —ç—Ç–æ —Å–≤—è–∑–∞–Ω–Ω–æ —Å —Ç–µ–º —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞ *ultra* —Ä–∞–≤–Ω—ã 1950, —Ç–æ –µ—Å—Ç—å –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª –∑–∞–¥–∞–Ω–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤, –≤ —Å–≤—è–∑–∏ —Å —á–µ–º –¥–∏—Å–ø–µ—Ä—Å–∏—è —Ä–∞–≤–Ω–∞ –Ω—É–ª—é. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—å –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É –æ —Ç–æ–º, —á—Ç–æ —Å—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ —Ä–∞–≤–Ω–∞, –∞ –∏–º–µ–Ω–Ω–æ, –µ—Å–ª–∏ –±—ã—Ç—å —Ç–æ—á–Ω–µ–µ, —Å—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–≤ *ultra* –±–æ–ª—å—à–µ. 

# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# <s>–£ –Ω–∞—Å –Ω–µ —Å–æ–≤—Å–µ–º –≤–µ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≥–∏–ø–æ—Ç–µ–∑–∞. 
#     
# –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –Ω–∞–º –≤–∞–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤—ã—Ä—É—á–∫–∏ —É –∫–ª–∏–µ–Ω—Ç–∞, —Ç.–∫. –º–µ—Ç–æ–¥ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π.
#     
# –ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –º—ã 2 —Ä–∞–∑–∞ —É—Å—Ä–µ–¥–Ω—è–µ–º –Ω–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–µ —Å–æ–≤—Å–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.
#     
# –î–∞–≤–∞–π —Ç–∞–∫–∂–µ –ø–æ–ø—Ä–∞–≤–∏–º —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç.
#     
# </div>

# ### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ú–æ—Å–∫–≤—ã –∏ –¥—Ä—É–≥–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
# 
# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–ª–µ–¥—É—é—â—É—é –≥–∏–ø–æ—Ç–µ–∑—É: —Å—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ú–æ—Å–∫–≤—ã –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Ä—É—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –¥—Ä—É–≥–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤. 
# 
# –ù—É–ª–µ–≤–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞: —Å—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ —Å –æ–±–æ–∏—Ö —Ä–µ–≥–µ–æ–Ω–æ–≤ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è. 
# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞: —Å—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è.

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# –ì–∏–ø–æ—Ç–µ–∑—ã —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã –≤–µ—Ä–Ω–æ.
#     
#     
#     
# </div>

# In[24]:


Moscow_query = all_costs.query('city == "–ú–æ—Å–∫–≤–∞"')
another_city_query = all_costs.query('city != "–ú–æ—Å–∫–≤–∞"')

def city_m(city_query):
    city_query = city_query.reset_index(drop=True)
    city_mean = []
    for i in col:
        for j in range(0, city_query.shape[0]):
            if city_query[i][j] != 0:
                city_mean.append(city_query[i][j])
    return city_mean

Moscow_mean = city_m(Moscow_query)
another_city_mean = city_m(another_city_query)

Moscow_var = np.var(Moscow_mean)
another_city_var = np.var(another_city_mean)

if (Moscow_var == another_city_var) :
    print('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å equal_val = True')
else:
    print('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å equal_val = False')


# In[25]:


results = st.ttest_ind(Moscow_mean, another_city_mean, equal_var = False)
print('p-–∑–Ω–∞—á–µ–Ω–∏–µ: ', results.pvalue)


# –ü–æ–ª—É—á–µ–Ω–Ω–æ–µ p-–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—å –Ω—É–ª–µ–≤—É—é –≥–∏–ø–æ—Ç–µ–∑—É –æ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –ø—Ä–∏–±—ã–ª–∏ —Å –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏ –∏ –ú–æ—Å–∫–≤—ã.
# 
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç

# In[65]:


value_list = []
frequency_list = []

for i in range(0, len(another_city_mean)):
    if another_city_mean[i] in value_list:
        cnt = value_list.index(another_city_mean[i])
        frequency_list[cnt] += 1
    else :
        value_list.append(another_city_mean[i])
        frequency_list.append(1)

df_smart_plot = pd.DataFrame(columns = ['value', 'frequency'])
df_smart_plot['value'] = value_list
df_smart_plot['frequency'] = frequency_list
df_smart_plot= df_smart_plot.sort_values(by='frequency')
df_smart_plot = df_smart_plot.set_index('value')
df_smart_plot.hist('frequency', bins=100, range=(-50,50))


# ## –û–±—â–∏–π –≤—ã–≤–æ–¥
# 
# –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –ª—é–¥–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç –ª–∏–º–∏—Ç—ã –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –≤ —Ç–∞—Ä–∏—Ñ–µ *ultra*, —á–µ–≥–æ –Ω–µ —Å–∫–∞–∂–µ—à—å –æ —Ç–∞—Ä–∏—Ñ–µ *smart*. –û–¥–Ω–∞–∫–æ –¥–∞–∂–µ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ —Ç–∞—Ä–∏—Ñ–∞ *smart* –∏ –µ–≥–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–≤—ã—à–∞—é—â–µ–µ –∫–æ–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ–π –ø—Ä–∏–±—ã–ª–∏, —á—Ç–æ –¥–∞–µ—Ç *ultra*. –¢–∞–∫–∂–µ –Ω–µ–º–∞–ª–æ–≤–∞–∂–Ω—ã–º —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –≤—ã—Ä—É—á–∫–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥–æ—Ä–æ–¥–∞ –ú–æ—Å–∫–≤—ã –≤—ã—à–µ, —á–µ–º –≤–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö. 
# 
# –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ –≤ –ú–æ—Å–∫–≤–µ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –±–æ–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ —Ç–∞—Ä–∏—Ñ—É *ultra*, –∞ –≤–æ—Ç –≤ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö –Ω–∞–æ–±–æ—Ä–æ—Ç —Ä–µ–∫–ª–∞–º–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ *smart*, –∫–æ—Ç–æ—Ä—ã–π —Å–≤–æ–µ–π –¥–µ—à–µ–≤–∏–∑–Ω–æ–π –±—É–¥–µ—Ç –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Ä–∞–∑—ã –±–æ–ª—å—à–µ —á–µ–º *ultra*, –∞ –∑–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –±—É–¥—É—Ç –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—É –≤—ã—Ä—É—á–∫—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–æ–ª—É—á–∏—Ç—å, –µ—Å–ª–∏ –±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±—ã —Ç–∞—Ä–∏—Ñ *ultima*.

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞:</b>
# 
# 
#     
# –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏ —ç—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–¥–æ–≤–∞—Ç—å üòä
#     
# –î–∞–≤–∞–π –ø–æ–ø—Ä–∞–≤–∏–º –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –±—É–¥–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ.
#     
# –ï—Å–ª–∏ —É —Ç–µ–±—è –≤–¥—Ä—É–≥ –µ—Å—á—Ç—å –∫–∞–∫–∏–µ‚Äì–ª–∏–±–æ –≤–æ–ø—Ä–æ—Å—ã, —Ç–æ —è —Å —Ä–∞–¥–æ—Å—Ç—å—é –æ—Ç–≤–µ—á—É –Ω–∞ –Ω–∏—Ö üòä
#        
# 
# </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ (2):</b>
# 
# –í—ã–≤–æ–¥—ã –ø–æ–Ω—è—Ç–Ω—ã –∏ –ª–æ–≥–∏—á–Ω—ã, –∞ —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω—ã –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏.
#        
# –í —Ü–µ–ª–æ–º —Å–∞–º –ø—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ! –ù–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π —Ä–∞–±–æ—Ç—ã —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è –≥–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ –∏ —ç—Ç–æ –±–µ–∑—É—Å–ª–æ–≤–Ω—ã–π –ø–ª—é—Å –¥–ª—è –Ω–∞—Å. –ë—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ –≤ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.
#        
# –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ –Ω–∞ —é—Ç—É–±–µ –Ω–∞–ø—Ä–∏–º–µ—Ä ‚Äì –∫—É—Ä—Å –ø–æ –ê–ª–≥–æ—Ä–∏—Ç–º–∞–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º –¥–∞–Ω–Ω—ã—Ö, —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏.
#     
# –ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Å —É—Å–ø–µ—à–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞ üòäüëç
#     
# –ò –∂–µ–ª–∞—é —É—Å–ø–µ—Ö–æ–≤ –≤ –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö üòä
#     
# **[–æ–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π]** –Ø—á–µ–π–∫–∏ **markdown** –≤ —Ç–æ–º —á–∏—Å–ª–µ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –û—Å—Ç–∞–≤–∏–ª –Ω–∏–∂–µ —Å—Å—ã–ª–∫—É, —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏.
# 
# https://sqlbak.com/blog/jupyter-notebook-markdown-cheatsheet
#  
#     
# </div>

# # –ß–µ–∫-–ª–∏—Å—Ç
# 
# - [x] –û–ø–∏—Å—ã–Ω—ã –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º—ã
# - [x] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫ –∞–Ω–∞–ª–∏–∑—É
# - [x] –ì—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã 
# - [x] –ü—Ä–æ–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
# - [x] –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∏ –¥–∏—Å–ø–µ—Ä—Å–∏—è
# - [x] –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏ –Ω—É–ª–µ–≤—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã
# - [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≥–∏–ø–æ—Ç–µ–∑—ã
# - [x] –ü—Ä–æ–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑—ã
# - [x] –í—ã–≤–æ–¥—ã —Å–¥–µ–ª–∞–Ω—ã
# - [x] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —à–∞–≥–∞–º –æ—Å—Ç–∞–≤–ª–µ–Ω—ã
